parameters:
  image: ''
  configuration: ''
  provider: ''

jobs:
- job: build
  displayName: Build
  pool:
    name: Default
    demands:
    - AZP_AGENT_PACKER -equals ${{ provider }}
    - AZP_AGENT_VAGRANT -equals ${{ provider }}
  workspace:
    clean: all
  timeoutInMinutes: 120

  steps:
  - checkout: self
    submodules: recursive

  - script: |
      dotnet cake build.cake --target=restore --configuration=${{ image }}-${{ provider }}-${{ configuration }}
    displayName: Restore

  - script: |
      dotnet cake build.cake --target=build --configuration=${{ image }}-${{ provider }}-${{ configuration }}
    displayName: Build
