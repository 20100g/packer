{
  "variables": {
    "chef_source": "provisioners/chef",
    "chef_destination": "C:/Windows/Temp/chef",
    "chef_restart_timeout": "30m"
  },
  "provisioners": [
    {
      "type": "powershell",
      "script": "{{user `chef_source`}}/scripts/prepare.ps1",
      "elevated_user": "{{user `elevated_user`}}",
      "elevated_password": "{{user `elevated_password`}}"
    },
    {
      "type": "file",
      "source": "{{user `chef_source`}}/upload/",
      "destination": "{{user `chef_destination`}}"
    },
    {
      "type": "windows-restart",
      "restart_timeout": "{{user `chef_restart_timeout`}}"
    },
    {
      "type": "powershell",
      "inline": [
        "cd {{user `chef_destination`}}; chef-client --local-mode --named-run-list prepare"
      ],
      "elevated_user": "{{user `elevated_user`}}",
      "elevated_password": "{{user `elevated_password`}}"
    },
    {
      "type": "windows-restart",
      "restart_timeout": "{{user `chef_restart_timeout`}}"
    },
    {
      "type": "powershell",
      "inline": [
        "cd {{user `chef_destination`}}; chef-client --local-mode --named-run-list install"
      ],
      "elevated_user": "{{user `elevated_user`}}",
      "elevated_password": "{{user `elevated_password`}}",
      "pause_before": "1m"
    },
    {
      "type": "windows-restart",
      "restart_timeout": "{{user `chef_restart_timeout`}}"
    },
    {
      "type": "powershell",
      "inline": [
        "cd {{user `chef_destination`}}; chef-client --local-mode --named-run-list patch"
      ],
      "elevated_user": "{{user `elevated_user`}}",
      "elevated_password": "{{user `elevated_password`}}"
    },
    {
      "type": "windows-restart",
      "restart_timeout": "{{user `chef_restart_timeout`}}"
    },
    {
      "type": "powershell",
      "inline": [
        "cd {{user `chef_destination`}}; chef-client --local-mode --named-run-list patch"
      ],
      "elevated_user": "{{user `elevated_user`}}",
      "elevated_password": "{{user `elevated_password`}}"
    },
    {
      "type": "windows-restart",
      "restart_timeout": "{{user `chef_restart_timeout`}}"
    },
    {
      "type": "powershell",
      "inline": [
        "cd {{user `chef_destination`}}; chef-client --local-mode --named-run-list patch"
      ],
      "elevated_user": "{{user `elevated_user`}}",
      "elevated_password": "{{user `elevated_password`}}"
    },
    {
      "type": "windows-restart",
      "restart_timeout": "{{user `chef_restart_timeout`}}"
    },
    {
      "type": "powershell",
      "inline": [
        "cd {{user `chef_destination`}}; chef-client --local-mode --named-run-list patch"
      ],
      "elevated_user": "{{user `elevated_user`}}",
      "elevated_password": "{{user `elevated_password`}}"
    },
    {
      "type": "windows-restart",
      "restart_timeout": "{{user `chef_restart_timeout`}}"
    },
    {
      "type": "powershell",
      "inline": [
        "cd {{user `chef_destination`}}; chef-client --local-mode --named-run-list cleanup"
      ],
      "elevated_user": "{{user `elevated_user`}}",
      "elevated_password": "{{user `elevated_password`}}"
    },
    {
      "type": "powershell",
      "script": "{{user `chef_source`}}/scripts/cleanup.ps1",
      "elevated_user": "{{user `elevated_user`}}",
      "elevated_password": "{{user `elevated_password`}}"
    }
  ]
}